<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<title>登录</title>
	<style>
		.clearfix:before,
		.clearfix:after {
			content: '';
			display: block;
			clear: both;
			width: 0;
			visibility: hidden
		}

		.clearfix {
			zoom: 1;
		}

		#img_l img {
			width: 100%;
			height: 100%;
			border-radius: 50%
		}
	</style>
	<script type="text/javascript" src="jquery.js"></script>
</head>

<body>
	<div class="clearfix" style="margin-left: 10%;margin-right: 10%" class="clearfix">
		<div style="float: left;width: 50%;height: 500px;background-color: red" class="clearfix">
			<img src="http://img2.imgtn.bdimg.com/it/u=1210667130,1030867550&fm=26&gp=0.jpg" alt="">
		</div>
		<div style="float: left;width: 50%;height: 500px;background-color: yellow" class="clearfix">
			<div class="clearfix"
				style="margin-right: 10%;margin-left: 10%;width: 80%;background-color: pink;height: 90%;margin-top: 5%;margin-bottom: 5%;">
				<!-- login -->
				<div
					style="margin-top: 30px;background-color: blue;line-height: 30px;float: left;margin-left: 40%;border:1px solid #ccc;padding:10px;width: 20%;text-align: center;">
					login</div>
				<!-- 注册 -->
				<div style="width: 90%;margin-left: 5%;margin-right: 5%;height:60%;background-color: #ccc;float: left;margin-top: 5px;border:1px solid #ccc;"
					id="z_l">
					<!-- 头像 -->
					<div style="height: 80px;background-color: orange;width: 80px;border-radius: 50%;margin:0 auto"
						id="img_l">

					</div>
					<div style="width: 100%;height: 40px;background-color: red;margin-top: 5px;line-height: 40px;">
						选择头像：<input type="file" id="files_l" accept="image/*">
					</div>
					<div style="width: 100%;height: 40px;background-color: red;margin-top: 5px;line-height: 40px;">
						昵称：<input type="text" style="width: 85%" id="names_l">
					</div>
					<div style="width: 100%;height: 40px;background-color: red;margin-top: 5px;line-height: 40px;">
						账号：<input type="text" style="width: 85%" id="user_l">
					</div>
					<div style="width: 100%;height: 40px;background-color: red;margin-top: 5px;line-height: 40px;">
						密码：<input type="text" style="width: 85%" id="pass_l">
					</div>
				</div>
				<!-- 登录 -->
				<div style="width: 90%;margin-left: 5%;margin-right: 5%;height:60%;background-color: #ccc;float: left;margin-top: 5px;display: none;border:1px solid #ccc;"
					id="d_l">
					<div style="width: 100%;height: 40px;background-color: red;margin-top: 5px;line-height: 40px;">
						账号：<input type="text" style="width: 85%" id="user_in">
					</div>
					<div style="width: 100%;height: 40px;background-color: red;margin-top: 5px;line-height: 40px;">
						密码：<input type="text" style="width: 85%" id="pass_in">
					</div>
				</div>
				<!-- 底部 -->
				<div
					style="width: 90%;margin-left: 5%;margin-right: 5%;height:15%;background-color: cyan;float: left;margin-top: 10px;">
					<button style="height: 80%;margin-left:10%;float: left;width: 30%;margin-top: 5px;"
						id="login_in">登录</button>
					<button style="height: 80%;margin-right:10%;float: right;width: 30%;margin-top: 5px;"
						id="login_up">注册</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var href = 'http://localhost:8000';
	var imgurl = ''
	// 头像
	files_l.onchange = function () {
		var f = files_l.files[0];
		var d = new FormData;
		d.append('img', f);
		console.log(d)
		$.ajax({
			url: href + '/files/img',
			type: 'post',
			data: d,
			processData: false,
			contentType: false,
			success(data) {
				console.log(data);
				imgurl = href + data;
				img_l.innerHTML = `<img src='${href}${data}'>`;
			}
		})
	}
	//注册
	login_up.onmousemove = function () {
		z_l.style.display = 'block';
		d_l.style.display = 'none';
	}
	login_up.onclick = function () {
		$.ajax({
			url: href + '/users/up',
			type: 'post',
			data: {
				img: imgurl,
				names: names_l.value,
				user: user_l.value,
				pass: pass_l.value
			},
			success(data) {
				console.log(data)
				if (data == 'ok') {
					alert('注册成功了')
					z_l.style.display = 'none';
					d_l.style.display = 'block';
					img_l.innerHTML = ''
					names_l.value = '';
					user_l.value = '';
					pass_l.value = '';

				} else {
					alert('注册失败');
					img_l.innerHTML = ''
					names_l.value = '';
					user_l.value = '';
					pass_l.value = '';
				}
			}
		})
	}
	//登录
	login_in.onmousemove = function () {
		z_l.style.display = 'none';
		d_l.style.display = 'block';
	}
	login_in.onclick = function () {
		$.ajax({
			url: href + '/users/in',
			type: 'post',
			data: {
				user: user_in.value,
				pass: pass_in.value
			},
			success(data) {
				console.log(data);
				if (data == 'ok') {
					alert('账号和密码不匹配')
				} else {
					alert('登录成功');
					localStorage.login = JSON.stringify(data)
					console.log(localStorage.login);
					location.href = 'index.html'
				}
			}
		})
	}
</script>

</html>